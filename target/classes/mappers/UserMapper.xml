<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.cvds.dao.mybatis.mappers.UserMapper">

    <select parameterType="map" id="getUser" resultMap="UserResult">
        SELECT
        u.id,
        u.name,
        u.password,
        u.email,
        u.status,
        u.numero_necesidades,
        u.numero_ofertas,

        ut.id as ut_id,
        ut.name as ut_name,
        ut.description as ut_description

        FROM users u
        JOIN usertypes ut 
        ON u.usertype = ut.id
        WHERE u.name = #{name}
    </select>

    <insert parameterType="map" id="InsertUser" >
        INSERT INTO users (name, password, email, status, usertype, numero_necesidades)
        VALUES(
          #{user.name},
          #{user.password},
          #{user.email},
          #{user.status},
          #{user.userType.id},
          #{user.numero_necesidades},
          #{user.numero_ofertas}) ;
    </insert>

    <select id="getNumero_necesidades" parameterType="map" resultType="int">
        SELECT numero_necesidades
        FROM users u
        WHERE u.id = #{userId}
    </select>

    <select id="getUserType" parameterType="map" resultType="int">
        SELECT usertype
        FROM users u
        WHERE u.id = #{userId}
    </select>

    <resultMap type='User' id='UserResult'>
        <id property='id' column='id'/>
        <result property='name' column='name'/>
        <result property='password' column='password'/>
        <result property='email' column='email'/>
        <result property='status' column='status'/>
        <result property='numero_necesidades' column='numero_necesidades'/>
        <result property='numero_ofertas' column='numero_ofertas'/>
        <association property='userType' javaType = 'UserType'>
            <id property='id' column='ut_id'/>
            <result property='name' column='ut_name'/>
            <result property='description' column='ut_description'/>
        </association>
    </resultMap>
          	
</mapper>