<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.cvds.dao.mybatis.mappers.NeedMapper">

    <insert parameterType="map" id="insertNeed">
        INSERT INTO needs (name, description, creationDate, status, modificationDate, urgency, category, usuario)
        VALUES(
          #{need.name},
          #{need.description},
          #{need.creationDate},
          #{need.status},
          #{need.modificationDate},
          #{need.urgency},
          #{categoryId},
          #{userId});
    </insert>

    <select id="getTotalNeedsOfUser" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM needs n
        WHERE n.usuario = #{userId};
    </select>

    <select id="getNeedsResult" parameterType="map" resultMap="NeedResult">
      SELECT id, 
      name,
      category,
      description,
      creationdate,
      status,
      modificationdate,
      urgency
      FROM needs
      WHERE needs.usuario = #{usuario};
    </select>

  <update parameterType="map" id="ActualizarNeed">
      update needs 
      set status = #{status},
      modificationdate=CURRENT_DATE
      where id = #{id};
  </update>

  <select id="getIdUserByNeed" parameterType="map" resultType="int">
    SELECT
      n.usuario
    FROM needs n
    WHERE id=#{id}
  </select>

  <resultMap type='Need' id='NeedResult'>
      <id property='id' column='id'/>
      <result property='name' column='name'/>
      <result property='description' column='description'/>
      <result property='creationDate' column='creationDate'/>
      <result property='status' column='status'/>
      <result property='modificationDate' column='modificationDate'/>
      <result property='urgency' column='urgency'/>
      <association property='category' javaType = 'Category'></association>
      <association property='usuario' javaType = 'User'></association>
  </resultMap>
          	
</mapper>